<!DOCTYPE html>
<!-- Built on Frappe. https://frappe.io/ -->
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Hooks</title>
	<meta name="generator" content="frappe">
    <link type="text/css" rel="stylesheet" href="https://frappe.github.io/frappe/assets/css/bootstrap.css">
    <link type="text/css" rel="stylesheet" href="https://frappe.github.io/frappe/assets/css/hljs.css">
    <link type="text/css" rel="stylesheet" href="https://frappe.github.io/frappe/assets/css/font-awesome.css">
    <link type="text/css" rel="stylesheet" href="https://frappe.github.io/frappe/assets/css/octicons/octicons.css">
    <link type="text/css" rel="stylesheet" href="https://frappe.github.io/frappe/assets/css/docs.css">

    
	<link rel="shortcut icon"
		href="/assets/img/favicon.ico"
		type="image/x-icon">
	<link rel="icon"
		href="/assets/img/favicon.ico"
		type="image/x-icon">
    

		</head>
<body data-path="user/en/guides/basics/hooks">
	<div class="main-section">
		<div>
				<header>
	<nav class="navbar navbar-default navbar-main" role="navigation">
		<div class="container">
			<div class="navbar-header">
				<a class="navbar-brand ellipsis"
					 href="https://frappe.github.io/frappe//">
					<span>Frappe Framework</span>
				</a>
				<div class="dropdown">
					<button class="btn btn-default navbar-toggle" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
						<i class="octicon octicon-three-bars"></i>
					</button>
					<ul class="dropdown-menu dropdown-menu-right">
<li data-label='<i class="octicon octicon-search"></i>' >
	<a href="/#"
		
		>
	<i class="octicon octicon-search"></i></a></li><li data-label='Developer Tutorials' >
	<a href="https://frappe.github.io/frappe/user"
		
		>
	Developer Tutorials</a></li><li data-label='API Documentation' >
	<a href="https://frappe.github.io/frappe/current"
		
		>
	API Documentation</a></li>

<li class="divider"></li>
<!-- post login tools -->

</ul>
				</div>
			</div>
			<div class="hidden-xs">
				
				<ul class="nav navbar-nav navbar-left">
</ul>
<ul class="nav navbar-nav navbar-right"><li data-label='<i class="octicon octicon-search"></i>' >
	<a href="/#"
		
		>
	<i class="octicon octicon-search"></i></a></li><li data-label='Developer Tutorials' >
	<a href="https://frappe.github.io/frappe/user"
		
		>
	Developer Tutorials</a></li><li data-label='API Documentation' >
	<a href="https://frappe.github.io/frappe/current"
		
		>
	API Documentation</a></li>
	
	<!-- post login tools -->

</ul>
				
			</div>
		</div>
	</nav>
</header><div class="hero-and-content">
                <div data-html-block="hero"></div>
                <div class="container" data-html-block="content">
                
<div class="page-container" id="page-user/en/guides/basics/hooks" data-path="{{ pathname }}"
	>
			<div class="row ">
				
				<div class=" page-content col-sm-12 ">
					<div class="page-content-wrapper">
						<div class="row page-head">
							<div class='col-sm-12'>
								
								<div class="page-breadcrumbs">
									
									
<ul class="breadcrumb">
	<li>
		<span class="icon icon-angle-left"></span>
		<a href="https://frappe.github.io/frappe//user/en/guides/basics">
		Basics</a>
	</li>
	
</ul>

									
								</div>
								
							</div>
							<div class="col-sm-8 col-xs-6">
								
							</div>
							<div class="col-sm-4 col-xs-6">
								

								
							</div>
						</div>
					</div>
					<div class="page_content">
<h1>Hooks</h1>

<!-- TODO: Add tables for quick reference -->

<p>Hooks are the duct tape of the Frappe system. Hooks allow you to "hook" in to
functionality and events of other parts of the Frappe system. Following are the
official hooks from Frappe. </p>

<h3>Application Name and Details</h3>

<ol>
<li><code>app_name</code> - slugified name with underscores e.g. "shopping_cart"</li>
<li><code>app_title</code> - full title name e.g. "Frappe"</li>
<li><code>app_publisher</code></li>
<li><code>app_description</code></li>
<li><code>app_version</code></li>
<li><code>app_icon</code> - font-awesome icon or image url</li>
<li><code>app_color</code> - hex colour background of the app icon</li>
</ol>

<h3>Install Events</h3>

<ol>
<li><code>before_install</code></li>
<li><code>after_install</code></li>
</ol>

<p>The above hooks are called before and after installation of the app they are in.
For example, <a href="/apps/erpnext">ERPNext</a>'s hooks contains a line,</p>

<pre><code>after_install = "erpnext.setup.install.after_install"
</code></pre>

<p>So, the function after_install is imported and called after ERPNext is installed.</p>

<p>Note, the <code>before_install</code> and <code>after_install</code> hooks are called with no arguments.</p>

<h3>Boot Session</h3>

<p>After a successful login, the Frappe JS Client requests for a resource called
<code>bootinfo</code>. The <code>bootinfo</code> is available as a global in Javascript via
<code>frappe.boot</code>. By default, the <code>bootinfo</code> contains</p>

<ul>
<li>System defaults</li>
<li>Notification status</li>
<li>Permissions</li>
<li>List of icons on desktop</li>
<li>User settings</li>
<li>Language and timezone info</li>
</ul>

<p>If your app wants to modify bootinfo, it can declare a hook <code>boot_session</code>. The
value is assumed to be a dotted path to a function and is called with one
argument, bootinfo which it can modify and return.</p>

<p>Eg,</p>

<pre><code>boot_session = "erpnext.startup.boot.boot_session"
</code></pre>

<h3>Notification configurations</h3>

<p>The notification configuration hook is expected to return a Python dictionary.</p>

<pre><code>{ 
    "for_doctype": {
        "Issue": {"status":"Open"},
        "Customer Issue": {"status":"Open"},
    },
    "for_module_doctypes": {
        "ToDo": "To Do",
        "Event": "Calendar",
        "Comment": "Messages"
    },
    "for_module": {
        "To Do": "frappe.core.notifications.get_things_todo",
        "Calendar": "frappe.core.notifications.get_todays_events",
        "Messages": "frappe.core.notifications.get_unread_messages"
    }
}
</code></pre>

<p>The above configuration has three parts,</p>

<ol>
<li><code>for_doctype</code> part of the above configuration marks any "Issue"
or "Customer Issue" as unread if its status is Open</li>
<li><code>for_module_doctypes</code> maps doctypes to module's unread count.</li>
<li><code>for_module</code> maps modules to functions to obtain its unread count. The
functions are called without any argument.</li>
</ol>

<h3>Javascript / CSS Assets</h3>

<p>The following hooks allow you to bundle built assets to your app for serving.
There are two types of assets, app and web. The app assets are loaded in the
Desk and web assets are loaded in the website.</p>

<ol>
<li><code>app_include_js</code></li>
<li><code>app_include_css</code></li>
<li><code>web_include_js</code></li>
<li><code>web_include_css</code></li>
</ol>

<p>Eg,</p>

<pre><code>app_include_js = "assets/js/erpnext.min.js"
web_include_js = "assets/js/erpnext-web.min.js"
</code></pre>

<p>Note: to create an asset bundle (eg, assets/js/erpnext.min.js) the target file
should be in build.json of your app.</p>

<h3>Configuring Reports</h3>

<p>In the report view, you can force filters as per doctype using <code>dump_report_map</code>
hook. The hook should be a dotted path to a Python function which will be called
without any arguments. Example of output of this function is below.</p>

<pre><code>"Warehouse": {
    "columns": ["name"],
    "conditions": ["docstatus &lt; 2"],
    "order_by": "name"
}
</code></pre>

<p>Here, for a report with Warehouse doctype, would include only those records that
are not cancelled (docstatus &lt; 2) and will be ordered by name.</p>

<h3>Modifying Website Context</h3>

<p>Context used in website pages can be modified by adding
a <code>update_website_context</code> hook. This hook should be a dotted path to a function
which will be called with a context (dictionary) argument.</p>

<h3>Customizing Email footer</h3>

<p>By default, for every email, a footer with content, "Sent via Frappe" is sent.
You can customize this globally by adding a <code>mail_footer</code> hook. The hook should
be a dotted path to a variable.</p>

<h3>Session Creation Hook</h3>

<p>You can attach custom logic to the event of a successful login using
<code>on_session_creation</code> hook. The hook should be a dotted path to a Python
function that takes login_manager as an argument.</p>

<p>Eg,</p>

<pre><code>def on_session_creation(login_manager):
    """make feed"""
    if frappe.session['user'] != 'Guest':
        # log to timesheet
        pass
</code></pre>

<h3>Website Clear Cache</h3>

<p>If you cache values in your views, the <code>website_clear_cache</code> allows you to hook
methods that invalidate your caches when Frappe tries to clear cache for all
website related pages.</p>

<h3>Document hooks</h3>

<h4>Permissions</h4>

<h4>Query Permissions</h4>

<p>You can customize how permissions are resolved for a DocType by hooking custom
permission match conditions using the <code>permission_query_conditions</code> hook. This
match condition is expected to be fragment for a where clause in an sql query.
Structure for this hook is as follows.</p>

<pre><code>permission_query_conditions = {
    "{doctype}": "{dotted.path.to.function}",
}
</code></pre>

<p>The output of the function should be a string with a match condition.
Example of such a function,</p>

<pre><code>def get_permission_query_conditions():
    return "(tabevent.event_type='public' or tabevent.owner='{user}'".format(user=frappe.session.user)
</code></pre>

<p>The above function returns a fragment that permits an event to listed if it's
public or owned by the current user.</p>

<h4>Document permissions</h4>

<p>You can hook to <code>doc.has_permission</code> for any DocType and add special permission
checking logic using the <code>has_permission</code> hook. Structure for this hook is,</p>

<pre><code>has_permission = {
    "{doctype}": "{dotted.path.to.function}",
}
</code></pre>

<p>The function will be passed the concerned document as an argument. It should
True or a falsy value after running the required logic. </p>

<p>For Example,</p>

<pre><code>def has_permission(doc):
    if doc.event_type=="Public" or doc.owner==frappe.session.user:
        return True
</code></pre>

<p>The above function permits an event if it's public or owned by the current user.</p>

<h4>CRUD Events</h4>

<p>You can hook to various CRUD events of any doctype, the syntax for such a hook
is as follows,</p>

<pre><code>doc_events = {
    "{doctype}": {
        "{event}": "{dotted.path.to.function}",
    }
}
</code></pre>

<p>To hook to events of all doctypes, you can use the follwing syntax also,</p>

<pre><code> doc_events = {
    "*": {
        "on_update": "{dotted.path.to.function}",
    }
 }
</code></pre>

<p>The hook function will be passed the doc in concern as the only argument.</p>

<h5>List of events</h5>

<ul>
<li><code>validate</code></li>
<li><code>before_save</code></li>
<li><code>after_save</code></li>
<li><code>before_insert</code></li>
<li><code>after_insert</code></li>
<li><code>before_submit</code></li>
<li><code>before_cancel</code></li>
<li><code>before_update_after_submit</code></li>
<li><code>on_update</code></li>
<li><code>on_submit</code></li>
<li><code>on_cancel</code></li>
<li><code>on_update_after_submit</code></li>
</ul>

<p>Eg, </p>

<pre><code>doc_events = {
    "Cab Request": {
        "after_insert": topcab.schedule_cab",
    }
}
</code></pre>

<h3>Scheduler Hooks</h3>

<p>Scheduler hooks are methods that are run periodically in background. Structure for such a hook is,</p>

<pre><code>scheduler_events = {
    "{event_name}": [
        "{dotted.path.to.function}"
    ],
}
</code></pre>

<h4>Events</h4>

<ul>
<li><code>daily</code></li>
<li><code>daily_long</code></li>
<li><code>weekly</code></li>
<li><code>weekly_long</code></li>
<li><code>monthly</code></li>
<li><code>monthly_long</code></li>
<li><code>hourly</code></li>
<li><code>all</code></li>
</ul>

<p>The scheduler events require celery, celerybeat and redis (or a supported and
configured broker) to be running. The events with suffix '_long' are for long
jobs. The <code>all</code> event is triggered everytime (as per the celerybeat interval).</p>

<p>Example,</p>

<pre><code>scheduler_events = {
    "{daily}": [
        "erpnext.accounts.doctype.sales_invoice.sales_invoice.manage_recurring_invoices"
    ],
    "{daily_long}": [
        "erpnext.setup.doctype.backup_manager.backup_manager.take_backups_daily"
    ],
}
</code></pre>

</div>
				</div>
			</div>
</div>

				
<div class="page-container">
	<div class="page-content">
	<div class="edit-container text-center">
		<i class="icon icon-smile"></i>
		<a class="text-muted edit" href="https://github.com/frappe/frappe/blob/develop/frappe/docs/user/en/guides/basics/hooks.md">
			Improve this page
		</a>
	</div>
	</div>
</div>
                </div>
            </div>
			<footer class="docs-footer">
				<div class="container"><div class="built-with-frappe text-center">
                    <img class="frappe-bird" src="https://frappe.github.io/frappe/assets/img/frappe-bird-grey.svg">
                    <h3>By Frappe Technologies</h3>
                </div>
                <div class="text-center">
                    <ul class="list-unstyled">
                        <li>
                            <a href="https://github.com/frappe/frappe">
                            Source</a>
                        </li>
                        <li>
                            <a href="https://github.com/frappe/frappe/issues">
                            Issues</a>
                        </li>
                        <li>
                            <a href="https://frappe.github.io/frappe/license.html">
                            License</a>
                        </li>
                        <li>
                            <a href="https://discuss.erpnext.com">
                            Forum</a>
                        </li>
                        <li>
                            <a href="https://frappe.io/apps">
                            Frappe Apps</a>
                        </li>
                    </ul>
                </div>

            </div>
			</footer>
		</div>
	</div>

	<script type="text/javascript" src="https://frappe.github.io/frappe/assets/js/jquery.min.js"></script>
	<script type="text/javascript" src="https://frappe.github.io/frappe/assets/js/bootstrap.min.js"></script>
	<script type="text/javascript" src="https://frappe.github.io/frappe/assets/js/highlight.pack.js"></script>
	<script type="text/javascript" src="https://frappe.github.io/frappe/assets/js/docs.js"></script>

	<!-- js should be loaded in body! -->
	<script>
        window.docs_base_url = "https://frappe.github.io/frappe";
    </script>

	<!-- csrf_token --></body>
</html>