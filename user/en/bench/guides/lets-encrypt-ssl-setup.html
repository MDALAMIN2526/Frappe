<!DOCTYPE html>
<!-- Built on Frappe. https://frappe.io/ -->
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Using Let's Encrypt to setup HTTPS</title>
	<meta name="generator" content="frappe">
    <link type="text/css" rel="stylesheet" href="https://frappe.github.io/frappe/assets/css/bootstrap.css">
    <link type="text/css" rel="stylesheet" href="https://frappe.github.io/frappe/assets/css/hljs.css">
    <link type="text/css" rel="stylesheet" href="https://frappe.github.io/frappe/assets/css/font-awesome.css">
    <link type="text/css" rel="stylesheet" href="https://frappe.github.io/frappe/assets/css/octicons/octicons.css">
    <link type="text/css" rel="stylesheet" href="https://frappe.github.io/frappe/assets/css/docs.css">

    
	<link rel="shortcut icon"
		href="/assets/img/favicon.ico"
		type="image/x-icon">
	<link rel="icon"
		href="/assets/img/favicon.ico"
		type="image/x-icon">
    

		</head>
<body data-path="user/en/bench/guides/lets-encrypt-ssl-setup">
	<div class="main-section">
		<div>
				<header>
	<nav class="navbar navbar-default navbar-main" role="navigation">
		<div class="container">
			<div class="navbar-header">
				<a class="navbar-brand ellipsis"
					 href="https://frappe.github.io/frappe//">
					<span>Frappe Framework</span>
				</a>
				<div class="dropdown">
					<button class="btn btn-default navbar-toggle" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
						<i class="octicon octicon-three-bars"></i>
					</button>
					<ul class="dropdown-menu dropdown-menu-right">
<li data-label='<i class="octicon octicon-search"></i>' >
	<a href="/#"
		
		>
	<i class="octicon octicon-search"></i></a></li><li data-label='Developer Tutorials' >
	<a href="https://frappe.github.io/frappe/user"
		
		>
	Developer Tutorials</a></li><li data-label='API Documentation' >
	<a href="https://frappe.github.io/frappe/current"
		
		>
	API Documentation</a></li>

<li class="divider"></li>
<!-- post login tools -->

</ul>
				</div>
			</div>
			<div class="hidden-xs">
				
				<ul class="nav navbar-nav navbar-left">
</ul>
<ul class="nav navbar-nav navbar-right"><li data-label='<i class="octicon octicon-search"></i>' >
	<a href="/#"
		
		>
	<i class="octicon octicon-search"></i></a></li><li data-label='Developer Tutorials' >
	<a href="https://frappe.github.io/frappe/user"
		
		>
	Developer Tutorials</a></li><li data-label='API Documentation' >
	<a href="https://frappe.github.io/frappe/current"
		
		>
	API Documentation</a></li>
	
	<!-- post login tools -->

</ul>
				
			</div>
		</div>
	</nav>
</header><div class="hero-and-content">
                <div data-html-block="hero"></div>
                <div class="container" data-html-block="content">
                
<div class="page-container" id="page-user/en/bench/guides/lets-encrypt-ssl-setup" data-path="{{ pathname }}"
	>
			<div class="row ">
				
				<div class=" page-content col-sm-12 ">
					<div class="page-content-wrapper">
						<div class="row page-head">
							<div class='col-sm-12'>
								
								<div class="page-breadcrumbs">
									
									
<ul class="breadcrumb">
	<li>
		<span class="icon icon-angle-left"></span>
		<a href="https://frappe.github.io/frappe//user/en/bench/guides">
		Guides</a>
	</li>
	
</ul>

									
								</div>
								
							</div>
							<div class="col-sm-8 col-xs-6">
								
							</div>
							<div class="col-sm-4 col-xs-6">
								

								
							</div>
						</div>
					</div>
					<div class="page_content">
<h1>Using Let's Encrypt to setup HTTPS</h1>

<h2>Prequisites</h2>

<ol>
<li>You need to have a DNS Multitenant Setup</li>
<li>Your site should be accessible via a valid domain</li>
<li>You need root permissions on your server</li>
</ol>

<p><strong>Note : Let's Encrypt Certificates expire every three months</strong></p>

<h2>Using Bench Command</h2>

<p>Just run: </p>

<pre><code>sudo -H bench setup lets-encrypt [site-name]
</code></pre>

<p>You will be faced with several prompts, respond to them accordingly. This command will also add an entry to the crontab of the user that will attempt to renew the certificate every month.</p>

<h3>Custom Domains</h3>

<p>You can setup Let's Encrypt for <a href="adding-custom-domains.html">custom domains</a> as well. Just use the <code>--custom-domain</code> option</p>

<pre><code>sudo -H bench setup lets-encrypt [site-name] --custom-domain [custom-domain]
</code></pre>

<h3>Renew Certificates</h3>

<p>To renew certificates manually you can use: </p>

<pre><code>sudo bench renew-lets-encrypt
</code></pre>

<hr>

<h2>Manual Method</h2>

<h3>Download the appropriate Certbot-auto script into /opt</h3>

<pre><code>https://certbot.eff.org/
</code></pre>

<h3>Stop nginx service</h3>

<pre><code>$ sudo service nginx stop
</code></pre>

<h3>Run Certbot</h3>

<pre><code>$ ./opt/certbot-auto certonly --standalone
</code></pre>

<p>After letsencrypt initializes, you will be prompted for some information. This exact prompts may vary depending on if you've used Let's Encrypt before, but we'll step you through the first time.</p>

<p>At the prompt, enter an email address that will be used for notices and lost key recovery:</p>

<p><img src="https://assets.digitalocean.com/articles/letsencrypt/le-email.png" alt="" /></p>

<p>Then you must agree to the Let's Encrypt Subscribe Agreement. Select Agree:</p>

<p><img src="https://assets.digitalocean.com/articles/letsencrypt/le-agreement.png" alt="" /></p>

<p>Then enter your domain name(s). Note that if you want a single cert to work with multiple domain names (e.g. example.com and www.example.com), be sure to include all of them:</p>

<p><img src="https://assets.digitalocean.com/articles/letsencrypt/le-domain.png" alt="" /></p>

<h3>Certificate Files</h3>

<p>After obtaining the cert, you will have the following PEM-encoded files:</p>

<ul>
<li><strong>cert.pem</strong>: Your domain's certificate</li>
<li><strong>chain.pem</strong>: The Let's Encrypt chain certificate</li>
<li><strong>fullchain.pem</strong>: cert.pem and chain.pem combined</li>
<li><strong>privkey.pem</strong>: Your certificate's private key</li>
</ul>

<p>These certificates are stored under <code>/etc/letsencrypt/live/example.com</code> folder</p>

<h3>Configure the certificates for your site(s)</h3>

<p>Go to your erpnext sites site_config.json</p>

<pre><code>$ cd frappe-bench/sites/{{ site_name }}
</code></pre>

<p>Add the following two lines to your site_config.json</p>

<pre><code>"ssl_certificate": "/etc/letsencrypt/live/example.com/fullchain.pem",
"ssl_certificate_key": "/etc/letsencrypt/live/example.com/privkey.pem"
</code></pre>

<p>Regenerate the nginx configuration</p>

<pre><code>$ bench setup nginx
</code></pre>

<p>Restart the nginx server</p>

<pre><code>$ sudo service nginx restart
</code></pre>

<hr />

<h3>Auto renewal (experimental)</h3>

<p>Login as root or a user with superuser privileges, run <code>crontab -e</code> and enter:</p>

<pre><code># renew letsencrypt certificates on 1st monday of every month and get an email if it gets executed
MAILTO="mail@example.com"
0 0 1-7 * * [ "$(date '+\%a')" = "Mon" ] &amp;&amp; sudo service nginx stop &amp;&amp; /opt/certbot-auto renew &amp;&amp; sudo service nginx start
</code></pre>

</div>
				</div>
			</div>
</div>

				
<div class="page-container">
	<div class="page-content">
	<div class="edit-container text-center">
		<i class="icon icon-smile"></i>
		<a class="text-muted edit" href="https://github.com/frappe/frappe/blob/develop/frappe/docs/user/en/bench/guides/lets-encrypt-ssl-setup.md">
			Improve this page
		</a>
	</div>
	</div>
</div>
                </div>
            </div>
			<footer class="docs-footer">
				<div class="container"><div class="built-with-frappe text-center">
                    <img class="frappe-bird" src="https://frappe.github.io/frappe/assets/img/frappe-bird-grey.svg">
                    <h3>By Frappe Technologies</h3>
                </div>
                <div class="text-center">
                    <ul class="list-unstyled">
                        <li>
                            <a href="https://github.com/frappe/frappe">
                            Source</a>
                        </li>
                        <li>
                            <a href="https://github.com/frappe/frappe/issues">
                            Issues</a>
                        </li>
                        <li>
                            <a href="https://frappe.github.io/frappe/license.html">
                            License</a>
                        </li>
                        <li>
                            <a href="https://discuss.erpnext.com">
                            Forum</a>
                        </li>
                        <li>
                            <a href="https://frappe.io/apps">
                            Frappe Apps</a>
                        </li>
                    </ul>
                </div>

            </div>
			</footer>
		</div>
	</div>

	<script type="text/javascript" src="https://frappe.github.io/frappe/assets/js/jquery.min.js"></script>
	<script type="text/javascript" src="https://frappe.github.io/frappe/assets/js/bootstrap.min.js"></script>
	<script type="text/javascript" src="https://frappe.github.io/frappe/assets/js/highlight.pack.js"></script>
	<script type="text/javascript" src="https://frappe.github.io/frappe/assets/js/docs.js"></script>

	<!-- js should be loaded in body! -->
	<script>
        window.docs_base_url = "https://frappe.github.io/frappe";
    </script>

	<!-- csrf_token --></body>
</html>